#!/usr/bin/env ruby

require 'main'
require 'stylr'

module Stylr
  Main {

    argument('directory') {
    description "The directory to be parsed."
    cast :string
  }

  option('meta') {
    default false
    description "Check for metaprogramming violations.  Defaults to false."
  }

  def run
    directory = params['directory'].values.first
    meta = params['meta'].values.first ? true : false
    lint = Lint.new
    dir_loader = DirLoader.new
    dir_loader.load_dir(directory)

    puts "filenames: #{dir_loader.filenames.inspect}"

    dir_loader.filenames.each do |filename|
      FileParser.new(filename, lint, true).violations?(meta)
    end
  end

  }
end

